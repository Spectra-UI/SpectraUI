      - name: Send release to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          TAG_NAME: ${{ github.event.release.tag_name }}
          RELEASE_BODY: ${{ github.event.release.body }}
          RELEASE_URL: ${{ github.event.release.html_url }}
          PRERELEASE: ${{ github.event.release.prerelease }}
          ACTOR: ${{ github.actor }}
        run: |
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "DISCORD_WEBHOOK secret is missing"
            exit 1
          fi

          # Skip prereleases
          if [ "$PRERELEASE" = "true" ]; then
            echo "Prerelease detected â€” skipping Discord notification."
            exit 0
          fi

          if [ -z "$RELEASE_BODY" ]; then
            RELEASE_BODY="A new stable version of SpectraUI is now available."
          fi

          # Discord embed description limit
          RELEASE_BODY="${RELEASE_BODY:0:4000}"

          jq -n \
            --arg title "New Stable Release: $TAG_NAME" \
            --arg body "$RELEASE_BODY" \
            --arg url "$RELEASE_URL" \
            --arg actor "$ACTOR" \
            '{
              embeds: [{
                title: $title,
                description: $body,
                url: $url,
                color: 2799359,
                fields: [
                  {
                    name: "Downloads",
                    value: "[CurseForge](https://www.curseforge.com/wow/addons/spectraui)\n[Wago](https://addons.wago.io/addons/spectraui)",
                    inline: false
                  }
                ],
                footer: {
                  text: "Released by " + $actor
                }
              }]
            }' | curl -X POST \
              -H "Content-Type: application/json" \
              -d @- \
              "$DISCORD_WEBHOOK"
